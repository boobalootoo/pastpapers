<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Files in Repository</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }
        h1 {
            margin-bottom: 20px;
        }
        ul {
            list-style-type: none;
            padding: 0;
            margin: 20px 0;
        }
        li {
            margin-bottom: 15px;
        }
        a {
            color: #0366d6;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        .loading {
            color: #666;
        }
        .error {
            color: #ff0000;
            font-weight: bold;
        }
        .pdf-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            margin-right: 5px;
            vertical-align: middle;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='currentColor' d='M20 2H8C7.175 2 6.5 2.675 6.5 3.5V17c0 .825.675 1.5 1.5 1.5h12c.825 0 1.5-.675 1.5-1.5V5c0-1.1-.9-2-2-2zm0 13h-12V10h12v5zm0-7H8V3.5c0-.276.224-.5.5-.5h11c.276 0 .5.224.5.5V8zM4 6h1.5v1.5H4V6zm0 2.5h1.5v1.5H4V8.5zm0 2.5h1.5v1.5H4v-1.5z'%3E%3C/path%3E%3C/svg%3E");
        }
        .section-title {
            margin-top: 30px;
            font-size: 20px;
            font-weight: bold;
            border-bottom: 2px solid #0366d6;
            padding-bottom: 5px;
            margin-bottom: 10px;
        }
        .file-pair {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
        }
        .file-link {
            display: block;
            color: #0366d6;
            text-decoration: none;
            margin-bottom: 5px;
        }
        .file-link:hover {
            text-decoration: underline;
        }
        .question-paper-link {
            font-weight: bold;
        }
        .mark-scheme-link {
            font-style: italic;
            color: #888;
        }

    </style>
</head>
<body>
    <h1>PDF Files in Repository</h1>
    <div id="loading" class="loading">Loading PDF files...</div>
    <div id="error" class="error" style="display:none;"></div>

    <h2 class="section-title">Computational thinking, algorithms and programming</h2>
    <div id="ctap-files"></div>

    <h2 class="section-title">Computer systems</h2>
    <div id="cs-files"></div>

    <script>
        const repoOwner = "boobalootoo";
        const repoName = "pastpapers";
        const ctapFilesContainer = document.getElementById("ctap-files");
        const csFilesContainer = document.getElementById("cs-files");
        const loadingIndicator = document.getElementById("loading");
        const errorDisplay = document.getElementById("error");

        // Function to fetch files from the GitHub API
        async function getRepoFiles() {
            try {
                const response = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents`);
                if (!response.ok) {
                    throw new Error(`GitHub API error: ${response.status}`);
                }
                const data = await response.json();
                return data;
            } catch (error) {
                loadingIndicator.style.display = "none";
                errorDisplay.style.display = "block";
                errorDisplay.textContent = `Error: ${error.message}`;
                console.error("Error fetching repository files:", error);
                return [];
            }
        }

        // Function to display the PDF files, organized into pairs
        async function displayPdfFiles() {
            const files = await getRepoFiles();
            loadingIndicator.style.display = "none";

            const ctapFiles = files.filter(file =>
                file.name.toLowerCase().includes("computational thinking") && file.name.toLowerCase().endsWith(".pdf")
            );
            const csFiles = files.filter(file =>
                file.name.toLowerCase().includes("computer systems") && file.name.toLowerCase().endsWith(".pdf")
            );

            function createAndAppendFilePair(container, questionPaper, markScheme) {
                const filePairDiv = document.createElement("div");
                filePairDiv.className = "file-pair";

                if (questionPaper) {
                    const questionPaperLink = document.createElement("a");
                    questionPaperLink.href = `https://github.com/${repoOwner}/${repoName}/blob/main/${questionPaper.name}`;
                    questionPaperLink.target = "_blank";
                    questionPaperLink.textContent = questionPaper.name;
                    questionPaperLink.className = "file-link question-paper-link";
                    filePairDiv.appendChild(questionPaperLink);
                }
                if (markScheme) {
                    const markSchemeLink = document.createElement("a");
                    markSchemeLink.href = `https://github.com/${repoOwner}/${repoName}/blob/main/${markScheme.name}`;
                    markSchemeLink.target = "_blank";
                    markSchemeLink.textContent = markScheme.name;
                    markSchemeLink.className = "file-link mark-scheme-link";
                    filePairDiv.appendChild(markSchemeLink);
                }
                container.appendChild(filePairDiv);
            }

            // Display CTAP files
            if (ctapFiles.length === 0) {
                ctapFilesContainer.textContent = "No PDF files found in this category.";
            } else {
                const displayedPairs = new Set(); // To track displayed pairs to avoid duplicates.

                ctapFiles.forEach(file => {
                    if (file.name.toLowerCase().includes("mark scheme")) {
                        const questionPaperName = file.name.toLowerCase().replace("mark scheme ", "");
                        const matchingQuestionPaper = ctapFiles.find(q => q.name.toLowerCase() === questionPaperName);

                        if (matchingQuestionPaper && !displayedPairs.has(matchingQuestionPaper.name)) {
                            createAndAppendFilePair(ctapFilesContainer, matchingQuestionPaper, file);
                            displayedPairs.add(matchingQuestionPaper.name);
                        }
                    }
                });

                // Display any question papers without a matching mark scheme
                ctapFiles.forEach(file => {
                    if (!file.name.toLowerCase().includes("mark scheme") && !displayedPairs.has(file.name)) {
                        createAndAppendFilePair(ctapFilesContainer, file, null); // null for mark scheme
                    }
                });
            }

            // Display CS files
            if (csFiles.length === 0) {
                csFilesContainer.textContent = "No PDF files found in this category.";
            } else {
                const displayedPairs = new Set();
                 csFiles.forEach(file => {
                    if (file.name.toLowerCase().includes("mark scheme")) {
                        const questionPaperName = file.name.toLowerCase().replace("mark scheme ", "");
                        const matchingQuestionPaper = csFiles.find(q => q.name.toLowerCase() === questionPaperName);

                        if (matchingQuestionPaper && !displayedPairs.has(matchingQuestionPaper.name)) {
                            createAndAppendFilePair(csFilesContainer, matchingQuestionPaper, file);
                            displayedPairs.add(matchingQuestionPaper.name);
                        }
                    }
                });

                // Display any question papers without a matching mark scheme
                csFiles.forEach(file => {
                    if (!file.name.toLowerCase().includes("mark scheme") && !displayedPairs.has(file.name)) {
                        createAndAppendFilePair(csFilesContainer, file, null); // null for mark scheme
                    }
                });
            }
        }

        // Call the function to display the PDF files when the page loads
        displayPdfFiles();
    </script>
</body>
</html>
